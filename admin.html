<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f3f4f6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; }
        .container { max-width: 1400px; margin: 0 auto; padding: 32px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .input { padding: 10px 14px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        .input:focus { outline: none; border-color: #667eea; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: white; padding: 24px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 12px; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9fafb; padding: 12px; text-align: left; font-size: 12px; font-weight: 600; color: #6b7280; text-transform: uppercase; }
        td { padding: 16px 12px; border-bottom: 1px solid #f3f4f6; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .hidden { display: none; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ========================================
        // SET ADMIN PASSWORD HERE
        // ========================================
        const ADMIN_PASSWORD = "admin123";  // CHANGE THIS!

        class AdminDashboard {
            constructor() {
                this.state = {
                    authenticated: false,
                    password: '',
                    results: [],
                    filter: 'all',
                    search: ''
                };
                this.render();
            }

            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.render();
            }

            login() {
                if (this.state.password === ADMIN_PASSWORD) {
                    this.setState({ authenticated: true });
                    this.loadResults();
                } else {
                    alert('Incorrect password');
                    this.setState({ password: '' });
                }
            }

            logout() {
                this.setState({ authenticated: false, password: '' });
            }

            loadResults() {
                const results = JSON.parse(localStorage.getItem('quizResults') || '[]');
                this.setState({ results: results.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)) });
            }

            getStats() {
                const total = this.state.results.length;
                const passed = this.state.results.filter(r => r.score >= 70).length;
                const failed = total - passed;
                const avgScore = total > 0 ? Math.round(this.state.results.reduce((sum, r) => sum + r.score, 0) / total) : 0;
                return { total, passed, failed, avgScore };
            }

            exportCSV() {
                const headers = ['Name', 'Email', 'Score (%)', 'Correct', 'Total', 'Status', 'Time (s)', 'Date', 'Time'];
                const rows = this.state.results.map(r => [
                    r.name, r.email, r.score, r.correct, r.total,
                    r.score >= 70 ? 'PASSED' : 'FAILED',
                    r.timeTaken, r.date, r.time
                ]);
                
                const csv = [headers.join(','), ...rows.map(row => row.map(cell => `"${cell}"`).join(','))].join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `quiz-results-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            }

            clearAll() {
                if (confirm('Delete ALL results? This cannot be undone!')) {
                    localStorage.removeItem('quizResults');
                    this.setState({ results: [] });
                }
            }

            getFilteredResults() {
                return this.state.results.filter(r => {
                    const matchesSearch = r.name.toLowerCase().includes(this.state.search.toLowerCase()) ||
                                         r.email.toLowerCase().includes(this.state.search.toLowerCase());
                    if (this.state.filter === 'passed') return matchesSearch && r.score >= 70;
                    if (this.state.filter === 'failed') return matchesSearch && r.score < 70;
                    return matchesSearch;
                });
            }

            render() {
                const app = document.getElementById('app');
                
                if (!this.state.authenticated) {
                    app.innerHTML = this.renderLogin();
                } else {
                    app.innerHTML = this.renderDashboard();
                }
                
                this.attachEvents();
            }

            renderLogin() {
                return `
                    <div style="min-height: 100vh; background: linear-gradient(135deg, #1f2937 0%, #6b21a8 100%); display: flex; align-items: center; justify-content: center; padding: 20px;">
                        <div class="card" style="max-width: 400px; width: 100%;">
                            <div style="text-align: center; margin-bottom: 32px;">
                                <div style="width: 80px; height: 80px; background: #ede9fe; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                                    <span style="font-size: 40px;">üîí</span>
                                </div>
                                <h1 style="font-size: 28px; margin-bottom: 8px;">Admin Access</h1>
                                <p style="color: #6b7280;">Enter password to view results</p>
                            </div>
                            <input type="password" class="input" id="password" placeholder="Admin Password" style="width: 100%; margin-bottom: 16px;" value="${this.state.password}">
                            <button class="btn btn-primary" style="width: 100%;" onclick="admin.login()">Login</button>
                        </div>
                    </div>
                `;
            }

            renderDashboard() {
                const stats = this.getStats();
                const filtered = this.getFilteredResults();

                return `
                    <div class="header no-print">
                        <div class="container">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h1 style="font-size: 28px; margin-bottom: 4px;">Admin Dashboard</h1>
                                    <p style="opacity: 0.9;">Quiz Results Management</p>
                                </div>
                                <button class="btn" style="background: rgba(255,255,255,0.2); color: white;" onclick="admin.logout()">Logout</button>
                            </div>
                        </div>
                    </div>

                    <div class="container">
                        <div class="stats-grid no-print">
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #dbeafe;">üë•</div>
                                <div style="color: #6b7280; font-size: 14px; margin-bottom: 4px;">Total Candidates</div>
                                <div style="font-size: 32px; font-weight: bold;">${stats.total}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #d1fae5;">‚úÖ</div>
                                <div style="color: #6b7280; font-size: 14px; margin-bottom: 4px;">Passed</div>
                                <div style="font-size: 32px; font-weight: bold; color: #10b981;">${stats.passed}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #fee2e2;">‚ùå</div>
                                <div style="color: #6b7280; font-size: 14px; margin-bottom: 4px;">Failed</div>
                                <div style="font-size: 32px; font-weight: bold; color: #ef4444;">${stats.failed}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background: #e9d5ff;">üìä</div>
                                <div style="color: #6b7280; font-size: 14px; margin-bottom: 4px;">Average Score</div>
                                <div style="font-size: 32px; font-weight: bold; color: #a855f7;">${stats.avgScore}%</div>
                            </div>
                        </div>

                        <div class="card no-print">
                            <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: space-between; align-items: center;">
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    <button class="btn btn-success" onclick="admin.exportCSV()">üì• Export CSV</button>
                                    <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Print</button>
                                    <button class="btn btn-danger" onclick="admin.clearAll()">üóëÔ∏è Clear All</button>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <select class="input" id="filter">
                                        <option value="all">All Results</option>
                                        <option value="passed">Passed Only</option>
                                        <option value="failed">Failed Only</option>
                                    </select>
                                    <input type="text" class="input" id="search" placeholder="Search..." style="min-width: 200px;">
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="overflow-x: auto;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th style="text-align: center;">Score</th>
                                            <th style="text-align: center;">Correct</th>
                                            <th style="text-align: center;">Status</th>
                                            <th style="text-align: center;">Time (s)</th>
                                            <th>Date & Time</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${filtered.length === 0 ? `
                                            <tr>
                                                <td colspan="8" style="text-align: center; color: #6b7280; padding: 40px;">No results found</td>
                                            </tr>
                                        ` : filtered.map((r, i) => `
                                            <tr>
                                                <td style="color: #6b7280;">${i + 1}</td>
                                                <td style="font-weight: 600;">${r.name}</td>
                                                <td style="color: #6b7280;">${r.email}</td>
                                                <td style="text-align: center;">
                                                    <span style="font-size: 18px; font-weight: bold; color: ${r.score >= 70 ? '#10b981' : '#ef4444'};">
                                                        ${r.score}%
                                                    </span>
                                                </td>
                                                <td style="text-align: center; color: #6b7280;">${r.correct}/${r.total}</td>
                                                <td style="text-align: center;">
                                                    <span class="badge ${r.score >= 70 ? 'badge-success' : 'badge-danger'}">
                                                        ${r.score >= 70 ? 'PASSED' : 'FAILED'}
                                                    </span>
                                                </td>
                                                <td style="text-align: center; color: #6b7280;">‚è±Ô∏è ${r.timeTaken}</td>
                                                <td>
                                                    <div style="color: #111827; font-size: 14px;">${r.date}</div>
                                                    <div style="color: #6b7280; font-size: 12px;">${r.time}</div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ${filtered.length > 0 ? `
                                <div style="text-align: center; margin-top: 16px; color: #6b7280; font-size: 14px;">
                                    Showing ${filtered.length} of ${this.state.results.length} results
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            attachEvents() {
                const password = document.getElementById('password');
                const filter = document.getElementById('filter');
                const search = document.getElementById('search');

                if (password) {
                    password.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') this.login();
                    });
                    password.addEventListener('input', (e) => {
                        this.state.password = e.target.value;
                    });
                }

                if (filter) {
                    filter.value = this.state.filter;
                    filter.addEventListener('change', (e) => {
                        this.setState({ filter: e.target.value });
                    });
                }

                if (search) {
                    search.value = this.state.search;
                    search.addEventListener('input', (e) => {
                        this.setState({ search: e.target.value });
                    });
                }
            }
        }

        const admin = new AdminDashboard();
    </script>
</body>
</html>
